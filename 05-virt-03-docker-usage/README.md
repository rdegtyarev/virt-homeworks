# Домашнее задание к занятию "5.3. Контейнеризация на примере Docker"

## Задача 1 

Посмотрите на сценарий ниже и ответьте на вопрос:
"Подходит ли в этом сценарии использование докера? Или лучше подойдет виртуальная машина, физическая машина? Или возможны разные варианты?"

Детально опишите и обоснуйте свой выбор.

--

Сценарий:

- Высоконагруженное монолитное java веб-приложение; 
- Go-микросервис для генерации отчетов;
- Nodejs веб-приложение;
- Мобильное приложение c версиями для Android и iOS;
- База данных postgresql используемая, как кэш;
- Шина данных на базе Apache Kafka;
- Очередь для Logstash на базе Redis;
- Elastic stack для реализации логирования продуктивного веб-приложения - три ноды elasticsearch, два logstash и две ноды kibana;
- Мониторинг-стек на базе prometheus и grafana;
- Mongodb, как основное хранилище данных для java-приложения;
- Jenkins-сервер.

### Решение
Сценарий:

- Высоконагруженное монолитное java веб-приложение;  
>В случае потребления большого количества ресурсов, лучше использовать виртуальную или физическую машину. Преимуществ использования контейнера не будет.
При низкой нагрузке и необходимости разместить на одной машине несколько Java приложений, лучше использовать Docker, для изолирования сред и возможности использовать разные версии Java.

- Go-микросервис для генерации отчетов;
>Лучше использовать Docker. В этом случае одном сервере можно держать несколько изолированных микросервисов с различным окружением.

- Nodejs веб-приложение;
>Лучше использовать Docker. В зависимости от архитектуры и при необходимости, можно использовать несколько экземляров приложения в разных контейнерах, с отдельным балансировщиком. В этом случае можно проводить работы, обновления без даунтайма.

- Мобильное приложение c версиями для Android и iOS;
>Если речь идет о сборке мобильных приложений, то можно использовать контейнеры.

- База данных postgresql используемая, как кэш;
>В этом случае лучше использовать физическую машину. Использование ДБ в качестве кеша диктует высокие требования к скорости чтения-записи с диска, это значит что использование VM не желаельно. 
При использовании контейнера придется выносить директорию БД за пределы контейнера и подключать при старте контейнера. В случае незапланированного отключения контейнера возможны проблемы с консистентностью данных, что может быть чувствительно при использовании в качестве кеша.

- Шина данных на базе Apache Kafka;
>Использование физической машины будет более надежным решением, но не удобным с точки зрения администрирования.
Можно использовать контейнеры при условии использования внешнего хранилища (чтобы не терять данные при перезапуске контейнера). Возможно лучшим решением будет кластер k8s. Добавит удобство в добавлении новых брокеров, возможност горизонтального маштабирования.

- Очередь для Logstash на базе Redis;
>Можно использовать контейнеры. Удобство деплоя, гибкость в выделении ресурсов.

- Elastic stack для реализации логирования продуктивного веб-приложения - три ноды elasticsearch, два logstash и две ноды kibana;
>Для удобства деплоя лучше использовать контейнеры.

- Мониторинг-стек на базе prometheus и grafana;
>Можно в контейнере. Возможность быстро развернуть из соотвествующих образов, конфигурационные файлы маппить из за предела контейнера.

- Mongodb, как основное хранилище данных для java-приложения;
> Лучше использовать виртуальную машину. По сравнению с физической машиной - будет возможность добавлять ресурсы при необходимости (в случае если виртуальная машина на кластере).

- Jenkins-сервер.
> Лучше использовать контейнере. Есть официальный образ Jenkins на dockerhub
---

## Задача 2 

Сценарий выполения задачи:

- создайте свой репозиторий на докерхаб; 
- выберете любой образ, который содержит апачи веб-сервер;
- создайте свой форк образа;
- реализуйте функциональность: 
запуск веб-сервера в фоне с индекс-страницей, содержащей HTML-код ниже: 
```
<html>
<head>
Hey, Netology
</head>
<body>
<h1>I’m kinda DevOps now</h1>
</body>
</html>
```
Опубликуйте созданный форк в своем репозитории и предоставьте ответ в виде ссылки на докерхаб-репо.

### Решение
Создаем Dockerfile  

```dockerfile
FROM httpd:2.4
COPY ./index.html /usr/local/apache2/htdocs/
```
Билдим образ и запускаем, проверяем и пушим в dockerhub
>docker build -t rdegtyarev/netology-hw .  
docker run --name apache -p 8080:80 rdegtyarev/netology-hw  
docker push rdegtyarev/netology-hw


Образ доступен в репозитории: rdegtyarev/netology-hw

---

## Задача 3 

- Запустите первый контейнер из образа centos c любым тэгом в фоновом режиме, подключив папку info из текущей рабочей директории на хостовой машине в /share/info контейнера;

- Запустите второй контейнер из образа debian:latest в фоновом режиме, подключив папку info из текущей рабочей директории на хостовой машине в /info контейнера;

- Подключитесь к первому контейнеру с помощью exec и создайте текстовый файл любого содержания в /share/info ;

- Добавьте еще один файл в папку info на хостовой машине;

- Подключитесь во второй контейнер и отобразите листинг и содержание файлов в /info контейнера.

### Решение

- Запустите первый контейнер из образа centos c любым тэгом в фоновом режиме, подключив папку info из текущей рабочей директории на хостовой машине в /share/info контейнера;
>docker run --name centos-01 -v `pwd`/info:/share/info -t -d centos


- Запустите второй контейнер из образа debian:latest в фоновом режиме, подключив папку info из текущей рабочей директории на хостовой машине в /info контейнера;
> docker run --name debian-01 -v `pwd`/info:/info -t -d debian:latest


- Подключитесь к первому контейнеру с помощью exec и создайте текстовый файл любого содержания в /share/info ;
>docker exec -ti centos-01 bash  
[root@08f5413a51da /]# cd ./share/info/  
[root@08f5413a51da info]# touch test-share-file

- Добавьте еще один файл в папку info на хостовой машине;
> Добавлен файл touch test-share-file

- Подключитесь во второй контейнер и отобразите листинг и содержание файлов в /info контейнера.
>docker exec -ti debian-01 bash  
root@68e6cb9fea1a:/# cd ./info/  
root@68e6cb9fea1a:/info# ls  
test-host-file  test-share-file  
